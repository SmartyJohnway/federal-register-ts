# Federal Register Ruby Gem - TypeScript Microservices Implementation Plan: Analysis Summary

**Date:** 2025-10-31

This document summarizes the analysis of the `federal_register` Ruby Gem, serving as the foundational specification for its re-implementation in TypeScript as a set of microservices. The goal is to replicate all functionalities and adhere to the architectural patterns observed in the original Ruby project.

---

## Group 1: Top-level Project Configuration and Metadata

This group provides the overall context, build setup, dependencies, and project metadata for the Ruby Gem.

| Filename / Path (Relative to `federal_register-master`) | Key Content & Functionality |
| :------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `.circleci/config.yml`                                  | CircleCI workflow definition. Specifies `ruby:2.6.3-stretch-node` as the Docker image, uses CircleCI's Ruby Orb for dependency installation and `rspec-test` for running tests. This indicates the project's CI/CD pipeline and testing strategy. |
| `.document`                                             | A manifest-like file (contents: `lib/**/*.rb`, `bin/*`, `features/**/*.feature`, `LICENSE.txt`). Likely used by packaging tools (e.g., Jeweler from `Rakefile`) to define which files belong to the gem. |
| `.gitignore`                                            | Standard `.gitignore` rules for Ruby/Bundler/YARD artifacts (`coverage`, `doc`, `.yardoc`, `.bundle`, `pkg`, `*.gem`). Ensures only relevant source code is committed to version control. |
| `.rubocop.yml`                                          | RuboCop configuration file. Many linting/style rules are explicitly disabled or customized (`Metrics/AbcSize`, `Metrics/LineLength`, etc.). This indicates the project's coding style preferences and deviations from standard RuboCop recommendations. |
| `.watchr`                                               | A Ruby script for development automation using Watchr. It monitors file changes (`spec/spec_helper.rb`, `spec/*_spec.rb`, `lib/*/test.rb`) and automatically runs related RSpec tests, providing Growl notifications. Useful for TDD/BDD workflows. |
| `codeinventory.json`                                    | Project metadata in JSON format. Describes the project as "Federal Register 2.0 Web Display" (Ruby tools for tracking content), specifies its open-source nature, tags (`NARA`, `API`, `FederalRegister`, `Ruby`), and contact information. |
| `federal_register.gemspec`                              | The RubyGems specification file generated by Jeweler. Defines gem properties like `name` ("federal_register"), `version` ("0.7.7"), `authors`, `description`, `email`, `homepage`, `licenses`, `require_paths`, `summary`. Crucially, it lists all files to be included in the gem (`s.files`) and its runtime (`httparty`) and development (`shoulda`, `bundler`, `rspec`, `activesupport`, `fakeweb`, `rubocop`, `rspec_junit_formatter`) dependencies. |
| `Gemfile`                                               | Standard Bundler `Gemfile`. Uses `source "https://rubygems.org"` and `gemspec` to load dependencies from `federal_register.gemspec`. Allows specifying additional development/test dependencies. |
| `Gemfile.lock`                                          | Generated by Bundler, precisely locking the versions of all gems (main and transitive dependencies) used in the project, ensuring reproducible builds. Includes `httparty`, `activesupport`, `rspec`, `rubocop`, `shoulda`, etc. |
| `LICENSE.md`                                            | Project license file. States the project is in the public domain within the United States (as a U.S. Government work) and uses the CC0 1.0 Universal Public Domain Dedication for worldwide waiver of copyright. |
| `Rakefile`                                              | Defines Rake tasks for the project. Includes `Jeweler` tasks for gem management (building, releasing), `RSpec::Core::RakeTask` for running tests (`spec`, `rcov`), and `RDoc::Task` for generating documentation. Sets `default` task to `spec`. |
| `README.md`                                             | The main project README, providing an overview, basic usage examples (`Document.find`, `Document.search`, `Agency.all`), contribution guidelines, and copyright information. |
| `VERSION`                                               | A simple text file containing the gem's version number (`0.7.7`). |

---

## Group 2: Core Ruby Files (`lib/federal_register/*.rb`)

This group contains the main classes and modules that define the gem's domain models and core functionalities for interacting with the Federal Register API.

| Filename / Path (Relative to `federal_register-master`) | Key Content & Functionality |
| :------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `lib/federal_register.rb`                               | The main entry file for the gem. It sets up the `FederalRegister` module and `require`s all other necessary support files from within the `federal_register/` subdirectory. This acts as the central orchestrator for loading the gem's components. |
| `lib/federal_register/agency.rb`                        | Defines the `FederalRegister::Agency` class. This class represents a Federal Register agency and provides methods to query agency data from the `/agencies` API endpoint, including `self.all` (fetch all agencies), `self.find` (by ID or slug), and `self.suggestions`. It inherits from `FederalRegister::Base`. |
| `lib/federal_register/article.rb`                       | A simple alias: `FederalRegister::Article = FederalRegister::Document`. This suggests `Article` was an older name for `Document` or is provided for backward compatibility. |
| `lib/federal_register/base.rb`                          | The foundational abstract class `FederalRegister::Base`. Most other domain model classes (`Agency`, `Document`, etc.) inherit from this. It includes `FederalRegister::Client` and provides: <br/>- `add_attribute`: A class method for dynamically defining getter methods for attributes, including type coercion for `:date`, `:datetime`, `:integer`. <br/>- `full?`: Checks if the object has been fully loaded (i.e., not just partial metadata). <br/>- `fetch_full`: Fetches the complete attributes of the object if it's not already full. <br/>- `self.override_base_uri`: A method to dynamically change the API's `base_uri` for all `FederalRegister` classes that use `HTTParty` (part of `FederalRegister::Client`). |
| `lib/federal_register/client.rb`                        | The HTTP client and error handling layer, `FederalRegister::Client`. It uses the `HTTParty` gem to make HTTP requests. <br/>- Defines `base_uri` as `https://www.federalregister.gov/api/v1`. <br/>- Implements a `self.get` method that wraps `HTTParty.get`, providing custom error handling and raising specific exceptions for common HTTP status codes (e.g., `BadRequest` for 400, `RecordNotFound` for 404, `ServerError` for 500). |
| `lib/federal_register/document.rb`                      | The central class for Federal Register documents, `FederalRegister::Document`. It inherits from `FederalRegister::Base` and extends `FederalRegister::Utilities` and `FederalRegister::DocumentUtilities`. <br/>- `add_attribute`: Defines numerous attributes for a document (e.g., `abstract`, `title`, `publication_date`, `html_url`, `body_html_url`, `document_number`). <br/>- `self.search(args)`: Performs a document search via `/documents.json`, returning a `FederalRegister::ResultSet`. <br/>- `self.find(document_number, options={})`: Fetches a single document by its `document_number` from `/documents/{document_number}.json`. Allows optional `publication_date` and `fields` in the query. <br/>- Defines methods to fetch various content types (e.g., `full_text_xml`, `body_html`) using their respective URLs. <br/>- Handles parsing associated `agencies` and `images` into `FederalRegister::Agency` and `FederalRegister::DocumentImage` objects. |
| `lib/federal_register/document_image.rb`                | Defines `FederalRegister::DocumentImage`. Represents an image associated with a document, providing `identifier`, `sizes`, `url_for(size)`, and `default_url` methods. Inherits from `FederalRegister::Document` (which seems incorrect, should likely be `FederalRegister::Base`). |
| `lib/federal_register/document_search_details.rb`       | Defines `FederalRegister::DocumentSearchDetails`, used to represent search details responses from the `/documents/search-details` endpoint. Provides `filters` and `suggestions`. |
| `lib/federal_register/document_utilities.rb`            | A module providing utility methods specifically for `FederalRegister::Document`. <br/>- `find_all(*args)`: A key method for fetching multiple documents by their numbers or citations. It manages batching requests when the generated URL exceeds `URL_CHARACTER_LIMIT` (2000 characters) to avoid API limitations. This involves `calculate_request_batches` to determine how many HTTP requests are needed. |
| `lib/federal_register/facet.rb`                         | The base class for all facet-related models, `FederalRegister::Facet`. <br/>- Provides a generic `self.search(args)` method that delegates to `FederalRegister::FacetResultSet.fetch`. <br/>- Holds `count`, `name`, `slug` attributes. |
| `lib/federal_register/facet_result_set.rb`              | A specialized `ResultSet` for handling responses from facet API endpoints. It processes the raw API response to create `FederalRegister::Facet` objects. |
| `lib/federal_register/highlighted_document.rb`          | Defines `FederalRegister::HighlightedDocument` for representing special documents that might have curated content, abstract, title, and most notably, a `photo` attribute with methods for generating photo URLs of various sizes and photo credit information. |
| `lib/federal_register/public_inspection_document.rb`    | Defines `FederalRegister::PublicInspectionDocument`, similar to `FederalRegister::Document` but for documents in the public inspection phase. It interacts with `/public-inspection-documents` endpoints. Provides `search`, `find`, `find_all`, `available_on` (for a specific date), and `current` (for the latest issue). |
| `lib/federal_register/public_inspection_document_search_details.rb` | Defines `FederalRegister::PublicInspectionDocumentSearchDetails`, for `/public-inspection-documents/search-details`. |
| `lib/federal_register/public_inspection_issue_result_set.rb` | A specialized `ResultSet` for public inspection issues, including `regular_filings_updated_at` and `special_filings_updated_at`. |
| `lib/federal_register/result_set.rb`                    | The generic `FederalRegister::ResultSet` class. It's `Enumerable` and handles common API response structures: `count`, `total_pages`, `results` (mapped to `result_class` objects). Crucially, it provides `next` and `previous` methods for pagination by loading `next_page_url` and `previous_page_url` from the API response. |
| `lib/federal_register/section.rb`                       | Defines `FederalRegister::Section` for interacting with the `/sections` API endpoint. Includes methods to search sections and access `highlighted_documents`. |
| `lib/federal_register/suggested_search.rb`              | Defines `FederalRegister::SuggestedSearch` for interacting with the `/suggested_searches` API endpoint. Provides `search` and `find` methods for suggested searches. |
| `lib/federal_register/topic.rb`                         | Defines `FederalRegister::Topic` for `/topics/suggestions` API endpoint, allowing querying for topic suggestions. |
| `lib/federal_register/utilities.rb`                     | A module providing utility methods, namely `extract_options` for cleanly separating options hash from other arguments in method calls. |

---

## Group 3: Facet-related Files (`lib/federal_register/facet/**/*.rb`)

This group defines various specialized facet classes used for statistical aggregation and filtering based on different dimensions of Federal Register data. These classes inherit from `FederalRegister::Facet` and define specific `self.url` methods pointing to their respective API facet endpoints.

| Filename / Path (Relative to `federal_register-master`) | Key Content & Functionality |
| :------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `lib/federal_register/facet/agency.rb`                  | Defines `FederalRegister::Facet::Agency`. Specifies the facet URL: `/documents/facets/agency`. |
| `lib/federal_register/facet/document.rb`                | Base class `FederalRegister::Facet::Document` for all document-related facets. |
| `lib/federal_register/facet/document/agency.rb`         | Defines `FederalRegister::Facet::Document::Agency`. Specifies its facet URL: `/documents/facets/agency`. |
| `lib/federal_register/facet/document/daily.rb`          | Defines `FederalRegister::Facet::Document::Daily` (daily frequency). URL: `/documents/facets/daily`. Inherits from `Frequency`. |
| `lib/federal_register/facet/document/frequency.rb`      | Base class `FederalRegister::Facet::Document::Frequency` for time-based document facets (daily, weekly, monthly, quarterly, yearly). Provides a `self.chart_url` method to generate URLs for visualization charts. |
| `lib/federal_register/facet/document/monthly.rb`        | Defines `FederalRegister::Facet::Document::Monthly` (monthly frequency). URL: `/documents/facets/monthly`. |
| `lib/federal_register/facet/document/quarterly.rb`      | Defines `FederalRegister::Facet::Document::Quarterly` (quarterly frequency). URL: `/documents/facets/quarterly`. |
| `lib/federal_register/facet/document/section.rb`        | Defines `FederalRegister::Facet::Document::Section`. URL: `/documents/facets/section`. |
| `lib/federal_register/facet/document/topic.rb`          | Defines `FederalRegister::Facet::Document::Topic`. URL: `/documents/facets/topic`. |
| `lib/federal_register/facet/document/type.rb`           | Defines `FederalRegister::Facet::Document::Type` (document type). URL: `/documents/facets/type`. |
| `lib/federal_register/facet/document/weekly.rb`         | Defines `FederalRegister::Facet::Document::Weekly` (weekly frequency). URL: `/documents/facets/weekly`. |
| `lib/federal_register/facet/document/yearly.rb`         | Defines `FederalRegister::Facet::Document::Yearly` (yearly frequency). URL: `/documents/facets/yearly`. |
| `lib/federal_register/facet/presidential_document_type.rb` | Defines `FederalRegister::Facet::PresidentialDocumentType`. URL: `/documents/facets/subtype`. |
| `lib/federal_register/facet/public_inspection_document.rb` | Base class `FederalRegister::Facet::PublicInspectionDocument` for public inspection document facets. |
| `lib/federal_register/facet/public_inspection_document/agencies.rb` | Defines `FederalRegister::Facet::PublicInspectionDocument::Agencies` (plural agencies). URL: `/public-inspection-documents/facets/agencies`. |
| `lib/federal_register/facet/public_inspection_document/agency.rb` | Defines `FederalRegister::Facet::PublicInspectionDocument::Agency` (singular agency). URL: `/public-inspection-documents/facets/agency`. |
| `lib/federal_register/facet/public_inspection_document/type.rb` | Defines `FederalRegister::Facet::PublicInspectionDocument::Type`. URL: `/public-inspection-documents/facets/type`. |
| `lib/federal_register/facet/public_inspection_issue.rb` | Base class `FederalRegister::Facet::PublicInspectionIssue`. It's a specialized facet that handles `special_filings` and `regular_filings` for public inspection issues. Provides a `search` method. |
| `lib/federal_register/facet/public_inspection_issue/daily.rb` | Defines `FederalRegister::Facet::PublicInspectionIssue::Daily`. URL: `/public-inspection-issues/facets/daily`. Uses `DailyFiling` class. |
| `lib/federal_register/facet/public_inspection_issue/daily_filing.rb` | Defines `FederalRegister::Facet::PublicInspectionIssue::DailyFiling`, representing a daily filing, with attributes like `agencies` and `documents`. |
| `lib/federal_register/facet/public_inspection_issue/type.rb` | Defines `FederalRegister::Facet::PublicInspectionIssue::Type`. URL: `/public-inspection-issues/facets/type`. Uses `TypeFiling` class. |
| `lib/federal_register/facet/public_inspection_issue/type_filing.rb` | Defines `FederalRegister::Facet::PublicInspectionIssue::TypeFiling`, representing a type filing, including `document_types` and `search_conditions`. |
| `lib/federal_register/facet/topic.rb`                   | Defines `FederalRegister::Facet::Topic`. URL: `/documents/facets/topic`. |

---

## Group 4: Testing Files (`spec/**/*.rb`)

This group contains the RSpec test suite that verifies the functionality of the Ruby Gem. These tests use `FakeWeb` to mock HTTP responses from the Federal Register API.

| Filename / Path (Relative to `federal_register-master`) | Key Content & Functionality |
| :------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `spec/agency_spec.rb`                                   | RSpec tests for `FederalRegister::Agency`. Verifies `self.all` method for fetching all agencies and checks attribute loading (e.g., `agency.name`). |
| `spec/base_spec.rb`                                     | RSpec tests for `FederalRegister::Base`. Verifies `add_attribute` functionality (dynamic attribute creation, type coercion for Date/DateTime/Integer) and `override_base_uri` for dynamically changing the API endpoint for all relevant classes. |
| `spec/document_spec.rb`                                 | RSpec tests for `FederalRegister::Document`. <br/> - `self.find`: Tests fetching a single document by number, including specific fields, publication date, and error handling (`RecordNotFound`). <br/> - `self.find_all`: Extensive tests for fetching multiple documents, including batching based on URL character limits, handling requested fields, unique document numbers, and responses with no documents. <br/> - `self.search`: Tests basic search functionality and ensures a `ResultSet` object is returned. <br/> - Tests attribute accessors like `full_text_xml` and `publication_date`. |
| `spec/public_inspection_document_spec.rb`               | RSpec tests for `FederalRegister::PublicInspectionDocument`. Verifies `self.find`, `self.find_all`, `self.available_on` (by date), and `self.current` methods, including error handling. |
| `spec/result_set_spec.rb`                               | RSpec tests for `FederalRegister::ResultSet`. Verifies pagination capabilities (`#next`, `#previous` methods) and `Enumerable` compliance (`#each` method). |
| `spec/spec_helper.rb`                                   | RSpec test helper file. <br/> - `$LOAD_PATH` modification to include `lib/` directory. <br/> - `require`s `rspec`, `fakeweb`, `active_support/ordered_hash`, `active_support/json`, `active_support/time`, and `federal_register`. <br/> - Configures `FakeWeb.allow_net_connect = false` to ensure test isolation and mock all external HTTP requests. <br/> - Configures RSpec syntax. |
